<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>魔法の端末 - Test</title>
    <style>
        body { background: #1a1a2e; color: white; text-align: center; font-family: sans-serif; }
        .panel { border: 2px solid #e94560; padding: 15px; margin: 10px; border-radius: 10px; }
        .hidden { display: none; }
        #display-img { max-width: 80%; border-radius: 10px; margin-top: 10px; }
        select, button { padding: 10px; margin: 5px; border-radius: 5px; }
    </style>
</head>
<body>
    <h1>魔法の端末</h1>

    <div class="panel">
        <h3>媒体接続状態</h3>
        <input type="text" id="manual-qr" placeholder="MEDIA:MDataName1">
        <button onclick="testScan()">QR読み込み(テスト)</button>
        <div id="current-media-id">未接続</div>
        <img id="display-img" class="hidden">
    </div>

    <div id="action-panel" class="panel hidden">
        <h3>魔法選択</h3>
        <select id="magic-select">
            <option value="Fire">火の魔法</option>
            <option value="Water">水の魔法</option>
        </select>
        <button onclick="castMagic()">魔法を使用</button>
    </div>

    <div id="result-panel" class="panel hidden">
        <h3>結果</h3>
        <p id="result-text"></p>
    </div>

    <script>
        // 擬似データ（本来はJSONから読み込む）
        const gameData = {
            "media_effects": {
                "MDataName1": {
                    "Fire": { "res": "氷の壁が溶け、道が現れた！", "img": "MDataName1_Fire.png" },
                    "Water": { "res": "水浸しになっただけだった。", "img": "MDataName1.png" }
                }
            }
        };

        function testScan() {
            const val = document.getElementById('manual-qr').value;
            if (val.startsWith("MEDIA:")) {
                const mediaId = val.split(":")[1];
                localStorage.setItem('currentMedia', mediaId);
                updateUI();
            } else {
                alert("無効な形式です");
            }
        }

        function updateUI() {
            const mediaId = localStorage.getItem('currentMedia');
            if (mediaId) {
                document.getElementById('current-media-id').innerText = "接続中: " + mediaId;
                document.getElementById('action-panel').classList.remove('hidden');
                
                // 画像を表示（リポジトリのパスに合わせて調整）
                const img = document.getElementById('display-img');
                img.src = `assets/media/${mediaId}.png`; 
                img.classList.remove('hidden');
            }
        }

        function castMagic() {
            const mediaId = localStorage.getItem('currentMedia');
            const magicId = document.getElementById('magic-select').value;
            const resultPanel = document.getElementById('result-panel');
            const resultText = document.getElementById('result-text');
            const img = document.getElementById('display-img');

            if (gameData.media_effects[mediaId] && gameData.media_effects[mediaId][magicId]) {
                const effect = gameData.media_effects[mediaId][magicId];
                resultText.innerText = effect.res;
                img.src = `assets/media/${effect.img}`; // 結果画像に差し替え
            } else {
                resultText.innerText = "何も起きなかった...";
            }
            resultPanel.classList.remove('hidden');
        }

        window.onload = updateUI;
    </script>
</body>
</html>
